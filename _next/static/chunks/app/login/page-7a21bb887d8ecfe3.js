(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{24654:function(){},92148:function(e,r,t){Promise.resolve().then(t.bind(t,95863))},37440:function(e,r,t){"use strict";t.d(r,{cn:function(){return i}});var n=t(44839),o=t(96164);function i(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,o.m6)((0,n.W)(r))}},95863:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return p}});var n=t(57437),o=t(2265),i=t(89733),a=t(48185),s=t(40133),c=t(16463),l=t(45099),u=t(91833),d=()=>{let{token:e,isTokenExpired:r,login:t,isLoading:i,getTokenFromRequest:a}=(0,s.a)(),d=(0,c.useRouter)(),f=(0,c.useSearchParams)().get("code"),{codeVerifier:p}=(0,l.f)(),[g,h]=(0,o.useState)(!1);return console.log("rebuild"),(0,o.useEffect)(()=>{!f||i||void 0===p||g||(h(!0),t(f,()=>{d.replace("/")}))},[f,i,p,t,d,g]),null===e||r()||d.replace("/"),(0,n.jsx)(u.f,{isLoading:i,onClick:function(e){e.preventDefault(),a()},label:"Se connecter"})},f=t(87138),p=()=>(0,n.jsx)("div",{className:"flex [&>div]:w-full h-screen",children:(0,n.jsxs)(a.Zb,{className:"rounded-xl border bg-card text-card-foreground shadow max-w-[700px] m-auto text-zinc-700",children:[(0,n.jsxs)(a.Ol,{children:[(0,n.jsx)(a.ll,{children:"Se connecter"}),(0,n.jsx)(a.SZ,{children:"Si vous poss\xe9dez d\xe9j\xe0 un compte MyECL, vous pouvez vous connecter avec."})]}),(0,n.jsx)(a.aY,{children:(0,n.jsx)("form",{children:(0,n.jsx)("div",{className:"grid w-full items-center gap-4",children:(0,n.jsx)(d,{})})})}),(0,n.jsxs)(a.eW,{className:"flex flex-row justify-between",children:[(0,n.jsx)(i.z,{variant:"link",children:(0,n.jsx)(f.default,{href:"/register",children:"Cr\xe9er un compte"})}),(0,n.jsx)(i.z,{variant:"link",children:(0,n.jsx)(f.default,{href:"/recover",children:"Mot de passe oubli\xe9 ?"})})]})]})})},89733:function(e,r,t){"use strict";t.d(r,{d:function(){return c},z:function(){return l}});var n=t(57437),o=t(2265),i=t(71538),a=t(12218),s=t(37440);let c=(0,a.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-red-700 text-destructive-foreground hover:bg-red-700/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=o.forwardRef((e,r)=>{let{className:t,variant:o,size:a,asChild:l=!1,...u}=e,d=l?i.g7:"button";return(0,n.jsx)(d,{className:(0,s.cn)(c({variant:o,size:a,className:t})),ref:r,...u})});l.displayName="Button"},48185:function(e,r,t){"use strict";t.d(r,{Ol:function(){return s},SZ:function(){return l},Zb:function(){return a},aY:function(){return u},eW:function(){return d},ll:function(){return c}});var n=t(57437),o=t(2265),i=t(37440);let a=o.forwardRef((e,r)=>{let{className:t,...o}=e;return(0,n.jsx)("div",{ref:r,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...o})});a.displayName="Card";let s=o.forwardRef((e,r)=>{let{className:t,...o}=e;return(0,n.jsx)("div",{ref:r,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",t),...o})});s.displayName="CardHeader";let c=o.forwardRef((e,r)=>{let{className:t,...o}=e;return(0,n.jsx)("h3",{ref:r,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",t),...o})});c.displayName="CardTitle";let l=o.forwardRef((e,r)=>{let{className:t,...o}=e;return(0,n.jsx)("p",{ref:r,className:(0,i.cn)("text-sm text-muted-foreground",t),...o})});l.displayName="CardDescription";let u=o.forwardRef((e,r)=>{let{className:t,...o}=e;return(0,n.jsx)("div",{ref:r,className:(0,i.cn)("p-6 pt-0",t),...o})});u.displayName="CardContent";let d=o.forwardRef((e,r)=>{let{className:t,...o}=e;return(0,n.jsx)("div",{ref:r,className:(0,i.cn)("flex items-center p-6 pt-0",t),...o})});d.displayName="CardFooter"},91833:function(e,r,t){"use strict";t.d(r,{f:function(){return a}});var n=t(57437),o=t(4867),i=t(89733);let a=e=>{let{isLoading:r,type:t,onClick:a,label:s,className:c,disabled:l,variant:u="default"}=e;return(0,n.jsx)(i.z,{variant:u,type:t,onClick:a,className:c,disabled:r||l,children:r?(0,n.jsx)(o.BGW,{className:"mr-2 h-4 w-4 animate-spin"}):s})}},40133:function(e,r,t){"use strict";t.d(r,{a:function(){return y}});var n=t(2265),o=t(42126),i=t(97334),a=t(39099),s=t(89291);let c=(0,a.Ue)()((0,s.mW)((0,s.tJ)(e=>({token:null,refreshToken:null,userId:null,setToken:r=>{let t=r?JSON.parse(atob(r.split(".")[1])).sub:null;e({token:r,userId:t})},setRefreshToken:r=>{e({refreshToken:r})}}),{name:"token-storage"})));var l=t(16463),u=t(64773),d=t(84475),f=t(40832),p=t(40932),g=t(45099);let h="RaidRegistering",m="https://raid-registering.myecl.fr/login",v="https://hyperion-3.dev.eclair.ec-lyon.fr",x=["API"],y=()=>{let e=(0,l.usePathname)(),[r,t]=(0,n.useState)(!1),{token:a,setToken:s,refreshToken:y,setRefreshToken:b,userId:k}=c(),{resetUser:w}=(0,u.L)(),{resetParticipant:j}=(0,d.p)(),{resetInviteToken:N}=(0,f.u)(),[_,C]=(0,n.useState)(!1),S=(0,l.useRouter)(),{codeVerifier:T,setCodeVerifier:R,resetCodeVerifier:z}=(0,g.f)(),O=(0,n.useRef)(null);async function J(e){let r=new TextEncoder().encode(e);return await crypto.subtle.digest("SHA-256",r).then(e=>btoa(Array.from(new Uint8Array(e)).map(e=>String.fromCharCode(e)).join("")).replace(/\+/g,"-").replace(/\//g,"_"))}async function U(e){t(!0);let r=(0,i.stringify)(e);try{let e=await o.Z.post("".concat(v,"/auth/token"),r,{headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"}});if(200!=e.status){t(!1);return}let n=e.data;t(!1),s(n.access_token),b(n.refresh_token)}catch(e){t(!1),A()&&(console.error(e),E())}}async function W(){return(console.log("refreshing tokens",r),r)?null:(t(!0),console.log("refreshing tokens"),y)?(await U({grant_type:"refresh_token",client_id:h,refresh_token:y}),y):null}function A(){return!!a&&(a?JSON.parse(atob(a.split(".")[1])).exp:0)<Math.floor(Date.now()/1e3)-60}async function L(e,t){if(console.log("logging in",r),!T||r){console.error("Code verifier not set");return}await U({grant_type:"authorization_code",client_id:h,code:e,redirect_uri:m,code_verifier:T}),C(!0),t&&t(),z()}async function V(){t(!0);let e=function(e){for(var r="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=t.length,o=crypto.getRandomValues(new Uint8Array(128)),i=0;i<128;i++)r+=t.charAt(Math.floor(o[i]/128*n));return r}(128);R(e);let r="".concat(v,"/auth/authorize?client_id=").concat(h,"&response_type=code&scope=").concat(x.join(" "),"&redirect_uri=").concat(m,"&code_challenge=").concat(await J(e),"&code_challenge_method=S256");window.location.href=r}function E(){s(null),b(null),C(!1),S.replace("/login"),w(),j(),N()}async function I(){return(console.log("getting token from storage"),r)?null:(t(!0),null!==a?C(!0):["/login","/recover","/register"].includes(null!=e?e:"")||S.replace("/login"),t(!1),a)}return(0,p.a)({queryKey:["lookToRefreshToken"],queryFn:()=>(function(){if(console.log("looking to refresh token"),O.current&&clearTimeout(O.current),null===a)return null;console.log("token",a?JSON.parse(atob(a.split(".")[1])).exp:0);let e=(a?JSON.parse(atob(a.split(".")[1])).exp:0)*1e3-Date.now()-6e4;return console.log("time to refresh token",e),e<=0?W():O.current=setTimeout(()=>{W(),O.current=null},e),a})(),retry:0,enabled:_,refetchOnMount:!1}),(0,p.a)({queryKey:["getTokenFromStorage"],queryFn:()=>I(),retry:0,enabled:!_,refetchOnMount:!1}),{getTokenFromRequest:V,isLoading:r,token:a,isTokenQueried:_,logout:E,userId:k,isTokenExpired:A,login:L}}},45099:function(e,r,t){"use strict";t.d(r,{f:function(){return i}});var n=t(39099),o=t(89291);let i=(0,n.Ue)()((0,o.mW)((0,o.tJ)(e=>({codeVerifier:void 0,setCodeVerifier:r=>{e({codeVerifier:r,isLoading:!0})},resetCodeVerifier:()=>{e({codeVerifier:void 0,isLoading:!1})},isLoading:!1}),{name:"raid-code-verifier-storage"})))},40832:function(e,r,t){"use strict";t.d(r,{u:function(){return i}});var n=t(39099),o=t(89291);let i=(0,n.Ue)()((0,o.mW)((0,o.tJ)(e=>({InviteToken:void 0,setInviteToken:r=>{e({inviteToken:r})},resetInviteToken:()=>{e({inviteToken:void 0})}}),{name:"raid-invite-token-storage"})))},84475:function(e,r,t){"use strict";t.d(r,{p:function(){return i}});var n=t(39099),o=t(89291);let i=(0,n.Ue)()((0,o.mW)((0,o.tJ)(e=>({participant:void 0,setParticipant:r=>{e({participant:r})},resetParticipant:()=>{e({participant:void 0})}}),{name:"raid-participant-storage"})))},64773:function(e,r,t){"use strict";t.d(r,{L:function(){return i}});var n=t(39099),o=t(89291);let i=(0,n.Ue)()((0,o.mW)((0,o.tJ)(e=>({user:void 0,setUser:r=>{e({user:r})},resetUser:()=>{e({user:void 0})}}),{name:"raid-user-storage"})))}},function(e){e.O(0,[310,756,629,971,23,744],function(){return e(e.s=92148)}),_N_E=e.O()}]);