(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{24654:function(){},31531:function(e,t,r){Promise.resolve().then(r.bind(r,10711))},1657:function(e,t,r){"use strict";r.d(t,{cn:function(){return o}});var n=r(75504),a=r(51367);function o(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,n.W)(t))}},10711:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return x}});var n=r(57437),a=r(2265),o=r(575),i=r(15671),s=r(22782),l=r(12647),c=r(29908),d=r(1657);let u=a.forwardRef((e,t)=>{let{className:r,type:o,...i}=e,[s,l]=a.useState(!1),u=()=>l(!s);return(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("input",{type:s?"text":"password",className:(0,d.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...i}),(0,n.jsx)("div",{className:"absolute inset-y-0 right-0 flex cursor-pointer items-center pr-3 text-gray-400",children:s?(0,n.jsx)(c.Rbo,{className:"h-4 w-4",onClick:u}):(0,n.jsx)(c.MBb,{className:"h-4 w-4",onClick:u})})]})});u.displayName="Input";let f=e=>{let{text:t}=e;return(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,n.jsx)("span",{className:"w-full border-t"})}),(0,n.jsx)("div",{className:"relative flex justify-center text-xs uppercase",children:(0,n.jsx)("span",{className:"bg-background px-2 text-muted-foreground",children:t})})]})};f.displayName="TextSeparator";var p=r(62177),m=r(37269),h=r(47907),g=()=>{let{getTokenFromRequest:e,token:t,isTokenQueried:r,isLoading:a}=(0,m.a)(),i=(0,h.useRouter)();return r&&null!==t&&i.replace("/"),(0,n.jsx)(o.z,{variant:"outline",onClick:function(t){t.preventDefault(),e(window)},disabled:a,children:a?(0,n.jsx)(p.BGW,{className:"mr-2 h-4 w-4 animate-spin"}):"MyECL"})},x=()=>(0,n.jsx)("div",{className:"flex [&>div]:w-full h-screen",children:(0,n.jsxs)(i.Zb,{className:"rounded-xl border bg-card text-card-foreground shadow max-w-[700px] m-auto text-zinc-700",children:[(0,n.jsxs)(i.Ol,{children:[(0,n.jsx)(i.ll,{children:"Se connecter"}),(0,n.jsx)(i.SZ,{children:"Connectez-vous avec MyECL ou par mail"})]}),(0,n.jsx)(i.aY,{children:(0,n.jsx)("form",{children:(0,n.jsxs)("div",{className:"grid w-full items-center gap-4",children:[(0,n.jsx)(g,{}),(0,n.jsx)(f,{text:"Ou continuez par email"}),(0,n.jsxs)("div",{className:"grid gap-2",children:[(0,n.jsx)(l._,{htmlFor:"email",children:"Email"}),(0,n.jsx)(s.I,{placeholder:"raid@exemple.com",id:"email"}),(0,n.jsx)("div",{className:"h-2"}),(0,n.jsx)(l._,{htmlFor:"password",children:"Mot de passe"}),(0,n.jsx)(u,{type:"password",hidden:!0})]}),(0,n.jsx)("div",{}),(0,n.jsx)(o.z,{className:"w-full",onClick:function(e){e.preventDefault(),console.log("The link was clicked.")},children:"Se connecter"})]})})}),(0,n.jsxs)(i.eW,{className:"flex flex-row justify-between",children:[(0,n.jsx)(o.z,{variant:"link",children:"Cr\xe9er un compte"}),(0,n.jsx)(o.z,{variant:"link",children:"Mot de passe oubli\xe9 ?"})]})]})})},575:function(e,t,r){"use strict";r.d(t,{d:function(){return l},z:function(){return c}});var n=r(57437),a=r(2265),o=r(59143),i=r(57742),s=r(1657);let l=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-red-700 text-destructive-foreground hover:bg-red-700/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,t)=>{let{className:r,variant:a,size:i,asChild:c=!1,...d}=e,u=c?o.g7:"button";return(0,n.jsx)(u,{className:(0,s.cn)(l({variant:a,size:i,className:r})),ref:t,...d})});c.displayName="Button"},15671:function(e,t,r){"use strict";r.d(t,{Ol:function(){return s},SZ:function(){return c},Zb:function(){return i},aY:function(){return d},eW:function(){return u},ll:function(){return l}});var n=r(57437),a=r(2265),o=r(1657);let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,o.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...a})});i.displayName="Card";let s=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",r),...a})});s.displayName="CardHeader";let l=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("h3",{ref:t,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight",r),...a})});l.displayName="CardTitle";let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("p",{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",r),...a})});c.displayName="CardDescription";let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,o.cn)("p-6 pt-0",r),...a})});d.displayName="CardContent";let u=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,o.cn)("flex items-center p-6 pt-0",r),...a})});u.displayName="CardFooter"},22782:function(e,t,r){"use strict";r.d(t,{I:function(){return i}});var n=r(57437),a=r(2265),o=r(1657);let i=a.forwardRef((e,t)=>{let{className:r,type:a,...i}=e;return(0,n.jsx)("input",{type:a,className:(0,o.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...i})});i.displayName="Input"},12647:function(e,t,r){"use strict";r.d(t,{_:function(){return c}});var n=r(57437),a=r(2265),o=r(24602),i=r(57742),s=r(1657);let l=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)(o.f,{ref:t,className:(0,s.cn)(l(),r),...a})});c.displayName=o.f.displayName},37269:function(e,t,r){"use strict";r.d(t,{a:function(){return g}});var n=r(2265),a=r(7908),o=r(13374),i=r(94505),s=r(47907),l=r(41328),c=r(65400),d=r(87456),u=r(49079);let f="Titan",p=u.env.NEXT_PUBLIC_REDIRECT_URL||"https://myecl.fr/static.html",m="https://hyperion-3.dev.eclair.ec-lyon.fr",h=["API"],g=()=>{let e;let[t,r]=(0,n.useState)(!1),{token:u,setToken:g,refreshToken:x,setRefreshToken:v}=(0,i.u)(),{resetUser:b}=(0,l.L)(),{resetParticipant:w}=(0,c.p)(),{resetInviteToken:y}=(0,d.u)(),[j,N]=(0,n.useState)(!1),k=(0,s.useRouter)();async function _(e){let t=new TextEncoder().encode(e);return await crypto.subtle.digest("SHA-256",t).then(e=>btoa(Array.from(new Uint8Array(e)).map(e=>String.fromCharCode(e)).join("")).replace(/\+/g,"-").replace(/\//g,"_"))}async function C(e){let t=(0,o.stringify)(e);try{let e=await a.Z.post("".concat(m,"/auth/token"),t,{headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"}});if(200!=e.status){r(!1);return}let n=e.data;r(!1),g(n.access_token),v(n.refresh_token)}catch(e){console.error(e),r(!1),S()}}async function R(){return(r(!0),console.log("refreshing tokens"),x)?(await C({grant_type:"refresh_token",client_id:f,refresh_token:x}),x):null}function I(){return!!u&&(u?JSON.parse(atob(u.split(".")[1])).exp:0)<Math.floor(Date.now()/1e3)}async function T(e){let t=function(e){for(var t="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=r.length,a=crypto.getRandomValues(new Uint8Array(e)),o=0;o<e;o++)t+=r.charAt(Math.floor(a[o]/e*n));return t}(128),n="".concat(m,"/auth/authorize?client_id=").concat(f,"&response_type=code&scope=").concat(h.join(" "),"&redirect_uri=").concat(p,"&code_challenge=").concat(await _(t),"&code_challenge_method=S256");r(!0);let a=window.outerHeight/2+window.screenY-450,o=window.outerWidth/2+window.screenX-400;e=window.open(n,"Hyperion","height=".concat(900,",width=").concat(800,",top=").concat(a,",left=").concat(o,",scrollbars=yes"));let i=setInterval(()=>{try{e&&e.closed&&(clearInterval(i),r(!1))}catch(e){console.error(e)}},1e3);window.addEventListener("message",r=>{let n=r.data;null!=n&&null!==new URL(n).searchParams.get("code")&&function(r){let n=new URL(r).searchParams.get("code");e&&(e.close(),e=null),C({grant_type:"authorization_code",client_id:f,code:n,redirect_uri:p,code_verifier:t})}(n)})}function S(){U(),g(null),v(null),N(!0),k.replace("/login"),b(),w(),y()}async function z(){return(console.log("getting token from storage"),t)?null:(r(!0),null!==u?(I()?R():(g(u),r(!1)),E()):(r(!1),k.replace("/login")),N(!0),u)}let E=()=>{console.log("starting background refreshing"),console.log("tokenRefreshInterval",12e4),clearInterval(e),e=setInterval(()=>{console.log("checking token"),I()&&!t&&R()},12e4)},U=()=>{clearInterval(e)};return j||t||z(),{getTokenFromRequest:T,isLoading:t,token:u,isTokenQueried:j,logout:S}}},87456:function(e,t,r){"use strict";r.d(t,{u:function(){return o}});var n=r(22020),a=r(65249);let o=(0,n.Ue)()((0,a.mW)((0,a.tJ)(e=>({InviteToken:void 0,setInviteToken:t=>{e({inviteToken:t})},resetInviteToken:()=>{e({inviteToken:void 0})}}),{name:"raid-invite-token-storage"})))},65400:function(e,t,r){"use strict";r.d(t,{p:function(){return o}});var n=r(22020),a=r(65249);let o=(0,n.Ue)()((0,a.mW)((0,a.tJ)(e=>({participant:void 0,setParticipant:t=>{e({participant:t})},resetParticipant:()=>{e({participant:void 0})}}),{name:"raid-participant-storage"})))},94505:function(e,t,r){"use strict";r.d(t,{u:function(){return o}});var n=r(22020),a=r(65249);let o=(0,n.Ue)()((0,a.mW)((0,a.tJ)(e=>({token:null,refreshToken:null,userId:null,setToken:t=>{let r=t?JSON.parse(atob(t.split(".")[1])).sub:null;e({token:t,userId:r})},setRefreshToken:t=>{e({refreshToken:t})}}),{name:"token-storage"})))},41328:function(e,t,r){"use strict";r.d(t,{L:function(){return o}});var n=r(22020),a=r(65249);let o=(0,n.Ue)()((0,a.mW)((0,a.tJ)(e=>({user:void 0,setUser:t=>{e({user:t})},resetUser:()=>{e({user:void 0})}}),{name:"raid-user-storage"})))},24602:function(e,t,r){"use strict";r.d(t,{f:function(){return i}});var n=r(14749),a=r(2265),o=r(29586);let i=(0,a.forwardRef)((e,t)=>(0,a.createElement)(o.WV.label,(0,n.Z)({},e,{ref:t,onMouseDown:t=>{var r;null===(r=e.onMouseDown)||void 0===r||r.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault()}})))}},function(e){e.O(0,[422,310,50,991,971,69,744],function(){return e(e.s=31531)}),_N_E=e.O()}]);