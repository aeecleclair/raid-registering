(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{24654:function(){},31531:function(e,r,t){Promise.resolve().then(t.bind(t,10711))},1657:function(e,r,t){"use strict";t.d(r,{cn:function(){return i}});var n=t(75504),o=t(51367);function i(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,o.m6)((0,n.W)(r))}},10711:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return h}});var n=t(57437),o=t(2265),i=t(575),a=t(15671),s=t(22782),l=t(12647),c=t(29908),d=t(1657);let u=o.forwardRef((e,r)=>{let{className:t,type:i,...a}=e,[s,l]=o.useState(!1),u=()=>l(!s);return(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("input",{type:s?"text":"password",className:(0,d.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...a}),(0,n.jsx)("div",{className:"absolute inset-y-0 right-0 flex cursor-pointer items-center pr-3 text-gray-400",children:s?(0,n.jsx)(c.Rbo,{className:"h-4 w-4",onClick:u}):(0,n.jsx)(c.MBb,{className:"h-4 w-4",onClick:u})})]})});u.displayName="Input";let f=e=>{let{text:r}=e;return(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,n.jsx)("span",{className:"w-full border-t"})}),(0,n.jsx)("div",{className:"relative flex justify-center text-xs uppercase",children:(0,n.jsx)("span",{className:"bg-background px-2 text-muted-foreground",children:r})})]})};f.displayName="TextSeparator";var p=t(68855),m=t(47907),g=t(26484),x=t(1800),v=()=>{let{token:e,isTokenExpired:r,login:t,isLoading:i,getTokenFromRequest:a}=(0,p.a)(),s=(0,m.useRouter)(),l=(0,m.useSearchParams)().get("code"),{codeVerifier:c,isLoading:d}=(0,g.f)();return(0,o.useEffect)(()=>{l&&!i&&void 0!==c&&t(l,()=>{s.replace("/")})},[l,i,c,t,s]),null===e||r()||s.replace("/"),(0,n.jsx)(x.f,{isLoading:i,onClick:function(e){e.preventDefault(),a()},label:"Se connecter",variant:"outline"})},h=()=>(0,n.jsx)("div",{className:"flex [&>div]:w-full h-screen",children:(0,n.jsxs)(a.Zb,{className:"rounded-xl border bg-card text-card-foreground shadow max-w-[700px] m-auto text-zinc-700",children:[(0,n.jsxs)(a.Ol,{children:[(0,n.jsx)(a.ll,{children:"Se connecter"}),(0,n.jsx)(a.SZ,{children:"Connectez-vous avec MyECL ou par mail"})]}),(0,n.jsx)(a.aY,{children:(0,n.jsx)("form",{children:(0,n.jsxs)("div",{className:"grid w-full items-center gap-4",children:[(0,n.jsx)(v,{}),(0,n.jsx)(f,{text:"Ou continuez par email"}),(0,n.jsxs)("div",{className:"grid gap-2",children:[(0,n.jsx)(l._,{htmlFor:"email",children:"Email"}),(0,n.jsx)(s.I,{placeholder:"raid@exemple.com",id:"email"}),(0,n.jsx)("div",{className:"h-2"}),(0,n.jsx)(l._,{htmlFor:"password",children:"Mot de passe"}),(0,n.jsx)(u,{type:"password",hidden:!0})]}),(0,n.jsx)("div",{}),(0,n.jsx)(i.z,{className:"w-full",onClick:function(e){e.preventDefault(),console.log("The link was clicked.")},children:"Se connecter"})]})})}),(0,n.jsxs)(a.eW,{className:"flex flex-row justify-between",children:[(0,n.jsx)(i.z,{variant:"link",children:"Cr\xe9er un compte"}),(0,n.jsx)(i.z,{variant:"link",children:"Mot de passe oubli\xe9 ?"})]})]})})},575:function(e,r,t){"use strict";t.d(r,{d:function(){return l},z:function(){return c}});var n=t(57437),o=t(2265),i=t(59143),a=t(57742),s=t(1657);let l=(0,a.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-red-700 text-destructive-foreground hover:bg-red-700/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=o.forwardRef((e,r)=>{let{className:t,variant:o,size:a,asChild:c=!1,...d}=e,u=c?i.g7:"button";return(0,n.jsx)(u,{className:(0,s.cn)(l({variant:o,size:a,className:t})),ref:r,...d})});c.displayName="Button"},15671:function(e,r,t){"use strict";t.d(r,{Ol:function(){return s},SZ:function(){return c},Zb:function(){return a},aY:function(){return d},eW:function(){return u},ll:function(){return l}});var n=t(57437),o=t(2265),i=t(1657);let a=o.forwardRef((e,r)=>{let{className:t,...o}=e;return(0,n.jsx)("div",{ref:r,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...o})});a.displayName="Card";let s=o.forwardRef((e,r)=>{let{className:t,...o}=e;return(0,n.jsx)("div",{ref:r,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",t),...o})});s.displayName="CardHeader";let l=o.forwardRef((e,r)=>{let{className:t,...o}=e;return(0,n.jsx)("h3",{ref:r,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",t),...o})});l.displayName="CardTitle";let c=o.forwardRef((e,r)=>{let{className:t,...o}=e;return(0,n.jsx)("p",{ref:r,className:(0,i.cn)("text-sm text-muted-foreground",t),...o})});c.displayName="CardDescription";let d=o.forwardRef((e,r)=>{let{className:t,...o}=e;return(0,n.jsx)("div",{ref:r,className:(0,i.cn)("p-6 pt-0",t),...o})});d.displayName="CardContent";let u=o.forwardRef((e,r)=>{let{className:t,...o}=e;return(0,n.jsx)("div",{ref:r,className:(0,i.cn)("flex items-center p-6 pt-0",t),...o})});u.displayName="CardFooter"},22782:function(e,r,t){"use strict";t.d(r,{I:function(){return a}});var n=t(57437),o=t(2265),i=t(1657);let a=o.forwardRef((e,r)=>{let{className:t,type:o,...a}=e;return(0,n.jsx)("input",{type:o,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...a})});a.displayName="Input"},12647:function(e,r,t){"use strict";t.d(r,{_:function(){return c}});var n=t(57437),o=t(2265),i=t(24602),a=t(57742),s=t(1657);let l=(0,a.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=o.forwardRef((e,r)=>{let{className:t,...o}=e;return(0,n.jsx)(i.f,{ref:r,className:(0,s.cn)(l(),t),...o})});c.displayName=i.f.displayName},1800:function(e,r,t){"use strict";t.d(r,{f:function(){return a}});var n=t(57437),o=t(62177),i=t(575);let a=e=>{let{isLoading:r,type:t,onClick:a,label:s,className:l,variant:c="default"}=e;return(0,n.jsx)(i.z,{variant:c,type:t,onClick:a,className:l,disabled:r,children:r?(0,n.jsx)(o.BGW,{className:"mr-2 h-4 w-4 animate-spin"}):s})}},68855:function(e,r,t){"use strict";t.d(r,{a:function(){return b}});var n=t(2265),o=t(7908),i=t(13374),a=t(22020),s=t(65249);let l=(0,a.Ue)()((0,s.mW)((0,s.tJ)(e=>({token:null,refreshToken:null,userId:null,setToken:r=>{let t=r?JSON.parse(atob(r.split(".")[1])).sub:null;e({token:r,userId:t})},setRefreshToken:r=>{e({refreshToken:r})}}),{name:"token-storage"})));var c=t(47907),d=t(41328),u=t(65400),f=t(87456),p=t(94642),m=t(26484);let g="RaidRegistering",x="https://raid-registering.myecl.fr/login",v="https://hyperion-3.dev.eclair.ec-lyon.fr",h=["API"],b=()=>{let[e,r]=(0,n.useState)(!1),{token:t,setToken:a,refreshToken:s,setRefreshToken:b,userId:y}=l(),{resetUser:w}=(0,d.L)(),{resetParticipant:j}=(0,u.p)(),{resetInviteToken:k}=(0,f.u)(),[N,_]=(0,n.useState)(!1),C=(0,c.useRouter)(),{codeVerifier:R,setCodeVerifier:T,resetCodeVerifier:S}=(0,m.f)(),z=(0,n.useRef)(null);async function I(e){let r=new TextEncoder().encode(e);return await crypto.subtle.digest("SHA-256",r).then(e=>btoa(Array.from(new Uint8Array(e)).map(e=>String.fromCharCode(e)).join("")).replace(/\+/g,"-").replace(/\//g,"_"))}async function W(e){r(!0);let t=(0,i.stringify)(e);try{let e=await o.Z.post("".concat(v,"/auth/token"),t,{headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"}});if(200!=e.status){r(!1);return}let n=e.data;r(!1),a(n.access_token),b(n.refresh_token)}catch(e){console.error(e),r(!1),D()}}async function J(){return(r(!0),console.log("refreshing tokens"),s)?(await W({grant_type:"refresh_token",client_id:g,refresh_token:s}),s):null}function O(){return!!t&&(t?JSON.parse(atob(t.split(".")[1])).exp:0)<Math.floor(Date.now()/1e3)-60}async function U(r,t){if(console.log("logging in",e),!R||e){console.error("Code verifier not set");return}await W({grant_type:"authorization_code",client_id:g,code:r,redirect_uri:x,code_verifier:R}),_(!0),t&&t(),S()}async function A(){r(!0);let e=function(e){for(var r="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=t.length,o=crypto.getRandomValues(new Uint8Array(e)),i=0;i<e;i++)r+=t.charAt(Math.floor(o[i]/e*n));return r}(128);T(e);let t="".concat(v,"/auth/authorize?client_id=").concat(g,"&response_type=code&scope=").concat(h.join(" "),"&redirect_uri=").concat(x,"&code_challenge=").concat(await I(e),"&code_challenge_method=S256");window.location.href=t}function D(){a(null),b(null),_(!1),C.replace("/login"),w(),j(),k()}async function E(){return(console.log("getting token from storage"),e)?null:(r(!0),null!==t?O()?J():(r(!1),_(!0),console.log("is token queried",N)):(r(!1),C.replace("/login")),t)}return(0,p.a)({queryKey:["lookToRefreshToken"],queryFn:()=>(function(){console.log("looking to refresh token"),z.current&&clearTimeout(z.current),console.log("token",t?JSON.parse(atob(t.split(".")[1])).exp:0);let e=(t?JSON.parse(atob(t.split(".")[1])).exp:0)*1e3-Date.now()-6e4;return console.log("time to refresh token",e),e<=0?J():z.current=setTimeout(()=>{J(),z.current=null},e),t})(),retry:0,enabled:N}),(0,p.a)({queryKey:["getTokenFromStorage"],queryFn:()=>E(),retry:0,enabled:!N}),{getTokenFromRequest:A,isLoading:e,token:t,isTokenQueried:N,logout:D,userId:y,isTokenExpired:O,login:U}}},26484:function(e,r,t){"use strict";t.d(r,{f:function(){return i}});var n=t(22020),o=t(65249);let i=(0,n.Ue)()((0,o.mW)((0,o.tJ)(e=>({codeVerifier:void 0,setCodeVerifier:r=>{e({codeVerifier:r,isLoading:!0})},resetCodeVerifier:()=>{e({codeVerifier:void 0,isLoading:!1})},isLoading:!1}),{name:"raid-code-verifier-storage"})))},87456:function(e,r,t){"use strict";t.d(r,{u:function(){return i}});var n=t(22020),o=t(65249);let i=(0,n.Ue)()((0,o.mW)((0,o.tJ)(e=>({InviteToken:void 0,setInviteToken:r=>{e({inviteToken:r})},resetInviteToken:()=>{e({inviteToken:void 0})}}),{name:"raid-invite-token-storage"})))},65400:function(e,r,t){"use strict";t.d(r,{p:function(){return i}});var n=t(22020),o=t(65249);let i=(0,n.Ue)()((0,o.mW)((0,o.tJ)(e=>({participant:void 0,setParticipant:r=>{e({participant:r})},resetParticipant:()=>{e({participant:void 0})}}),{name:"raid-participant-storage"})))},41328:function(e,r,t){"use strict";t.d(r,{L:function(){return i}});var n=t(22020),o=t(65249);let i=(0,n.Ue)()((0,o.mW)((0,o.tJ)(e=>({user:void 0,setUser:r=>{e({user:r})},resetUser:()=>{e({user:void 0})}}),{name:"raid-user-storage"})))},24602:function(e,r,t){"use strict";t.d(r,{f:function(){return a}});var n=t(14749),o=t(2265),i=t(29586);let a=(0,o.forwardRef)((e,r)=>(0,o.createElement)(i.WV.label,(0,n.Z)({},e,{ref:r,onMouseDown:r=>{var t;null===(t=e.onMouseDown)||void 0===t||t.call(e,r),!r.defaultPrevented&&r.detail>1&&r.preventDefault()}})))}},function(e){e.O(0,[422,310,470,536,971,69,744],function(){return e(e.s=31531)}),_N_E=e.O()}]);