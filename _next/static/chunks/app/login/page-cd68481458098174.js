(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{24654:function(){},92148:function(e,t,r){Promise.resolve().then(r.bind(r,95863))},37440:function(e,t,r){"use strict";r.d(t,{cn:function(){return i}});var n=r(44839),o=r(96164);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,o.m6)((0,n.W)(t))}},95863:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p}});var n=r(57437),o=r(2265),i=r(89733),a=r(48185),s=r(40133),c=r(16463),u=r(45099),l=r(44032),d=()=>{let{token:e,isTokenExpired:t,login:r,isLoading:i,getTokenFromRequest:a}=(0,s.a)(),d=(0,c.useRouter)(),f=(0,c.useSearchParams)().get("code"),{codeVerifier:p}=(0,u.f)(),[h,m]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{!f||i||void 0===p||h||(m(!0),r(f,()=>{d.replace("/")}))},[f,i,p,r,d,h]),null===e||t()||d.replace("/"),(0,n.jsx)(l.f,{isLoading:i,onClick:function(e){e.preventDefault(),a()},label:"Se connecter"})},f=r(87138),p=()=>(0,n.jsx)("div",{className:"flex [&>div]:w-full h-screen",children:(0,n.jsxs)(a.Zb,{className:"rounded-xl border bg-card text-card-foreground shadow max-w-[700px] m-auto text-zinc-700",children:[(0,n.jsxs)(a.Ol,{children:[(0,n.jsx)(a.ll,{children:"Se connecter"}),(0,n.jsx)(a.SZ,{children:"Si vous poss\xe9dez d\xe9j\xe0 un compte MyECL, vous pouvez vous connecter avec."})]}),(0,n.jsx)(a.aY,{children:(0,n.jsx)("form",{children:(0,n.jsx)("div",{className:"grid w-full items-center gap-4",children:(0,n.jsx)(d,{})})})}),(0,n.jsxs)(a.eW,{className:"flex flex-row justify-between",children:[(0,n.jsx)(i.z,{variant:"link",children:(0,n.jsx)(f.default,{href:"/register",children:"Cr\xe9er un compte"})}),(0,n.jsx)(i.z,{variant:"link",children:(0,n.jsx)(f.default,{href:"/recover",children:"Mot de passe oubli\xe9 ?"})})]})]})})},44032:function(e,t,r){"use strict";r.d(t,{f:function(){return a}});var n=r(57437),o=r(4867),i=r(89733);let a=e=>{let{isLoading:t,type:r,onClick:a,label:s,className:c,disabled:u,variant:l="default"}=e;return(0,n.jsx)(i.z,{variant:l,type:r,onClick:a,className:c,disabled:t||u,children:t?(0,n.jsx)(o.BGW,{className:"h-4 w-4 animate-spin"}):s})}},89733:function(e,t,r){"use strict";r.d(t,{d:function(){return c},z:function(){return u}});var n=r(57437),o=r(2265),i=r(71538),a=r(12218),s=r(37440);let c=(0,a.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-red-700 text-destructive-foreground hover:bg-red-700/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),u=o.forwardRef((e,t)=>{let{className:r,variant:o,size:a,asChild:u=!1,...l}=e,d=u?i.g7:"button";return(0,n.jsx)(d,{className:(0,s.cn)(c({variant:o,size:a,className:r})),ref:t,...l})});u.displayName="Button"},48185:function(e,t,r){"use strict";r.d(t,{Ol:function(){return s},SZ:function(){return u},Zb:function(){return a},aY:function(){return l},eW:function(){return d},ll:function(){return c}});var n=r(57437),o=r(2265),i=r(37440);let a=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,n.jsx)("div",{ref:t,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...o})});a.displayName="Card";let s=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,n.jsx)("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",r),...o})});s.displayName="CardHeader";let c=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,n.jsx)("h3",{ref:t,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",r),...o})});c.displayName="CardTitle";let u=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,n.jsx)("p",{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",r),...o})});u.displayName="CardDescription";let l=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,n.jsx)("div",{ref:t,className:(0,i.cn)("p-6 pt-0",r),...o})});l.displayName="CardContent";let d=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,n.jsx)("div",{ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",r),...o})});d.displayName="CardFooter"},78068:function(e,t,r){"use strict";r.d(t,{Am:function(){return d},pm:function(){return f}});var n=r(2265);let o=0,i=new Map,a=e=>{if(i.has(e))return;let t=setTimeout(()=>{i.delete(e),l({type:"REMOVE_TOAST",toastId:e})},1e6);i.set(e,t)},s=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?a(r):e.toasts.forEach(e=>{a(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},c=[],u={toasts:[]};function l(e){u=s(u,e),c.forEach(e=>{e(u)})}function d(e){let{...t}=e,r=(o=(o+1)%Number.MAX_SAFE_INTEGER).toString(),n=()=>l({type:"DISMISS_TOAST",toastId:r});return l({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||n()}}}),{id:r,dismiss:n,update:e=>l({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function f(){let[e,t]=n.useState(u);return n.useEffect(()=>(c.push(t),()=>{let e=c.indexOf(t);e>-1&&c.splice(e,1)}),[e]),{...e,toast:d,dismiss:e=>l({type:"DISMISS_TOAST",toastId:e})}}},40133:function(e,t,r){"use strict";r.d(t,{a:function(){return b}});var n=r(2265),o=r(42126),i=r(97334),a=r(39099),s=r(89291);let c=(0,a.Ue)()((0,s.mW)((0,s.tJ)(e=>({token:null,refreshToken:null,userId:null,setToken:t=>{let r=t?JSON.parse(atob(t.split(".")[1])).sub:null;e({token:t,userId:r})},setRefreshToken:t=>{e({refreshToken:t})}}),{name:"token-storage"})));var u=r(16463),l=r(64773),d=r(84475),f=r(40832),p=r(40932),h=r(45099),m=r(78068);let v="RaidRegistering",g="".concat("https//inscription-raid.myecl.fr","/login"),x="https://hyperion-3.dev.eclair.ec-lyon.fr",y=["API"],b=()=>{let e=(0,u.usePathname)(),[t,r]=(0,n.useState)(!1),{token:a,setToken:s,refreshToken:b,setRefreshToken:T,userId:w}=c(),{resetUser:S}=(0,l.L)(),{resetParticipant:_}=(0,d.p)(),{resetInviteToken:k}=(0,f.u)(),[j,N]=(0,n.useState)(!1),A=(0,u.useRouter)(),{codeVerifier:O,setCodeVerifier:C,resetCodeVerifier:E}=(0,h.f)(),R=(0,n.useRef)(null);async function I(e){let t=new TextEncoder().encode(e);return await crypto.subtle.digest("SHA-256",t).then(e=>btoa(Array.from(new Uint8Array(e)).map(e=>String.fromCharCode(e)).join("")).replace(/\+/g,"-").replace(/\//g,"_"))}async function D(e){r(!0);let t=(0,i.stringify)(e);try{let e=await o.Z.post("".concat(x,"/auth/token"),t,{headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"}});if(200!=e.status){r(!1),(0,m.Am)({title:"Erreur",description:"Une erreur est survenue lors de la connexion",variant:"destructive"});return}let n=e.data;r(!1),s(n.access_token),T(n.refresh_token)}catch(e){r(!1),U()&&W()}}async function M(){return t?null:(r(!0),b)?(await D({grant_type:"refresh_token",client_id:v,refresh_token:b}),b):null}function U(){return!!a&&(a?JSON.parse(atob(a.split(".")[1])).exp:0)<Math.floor(Date.now()/1e3)-60}async function z(e,r){O&&!t&&(await D({grant_type:"authorization_code",client_id:v,code:e,redirect_uri:g,code_verifier:O}),N(!0),r&&r(),E())}async function V(){r(!0);let e=function(e){for(var t="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=r.length,o=crypto.getRandomValues(new Uint8Array(128)),i=0;i<128;i++)t+=r.charAt(Math.floor(o[i]/128*n));return t}(128);C(e);let t="".concat(x,"/auth/authorize?client_id=").concat(v,"&response_type=code&scope=").concat(y.join(" "),"&redirect_uri=").concat(g,"&code_challenge=").concat(await I(e),"&code_challenge_method=S256");window.location.href=t}function W(){s(null),T(null),N(!1),A.replace("/login"),S(),_(),k()}async function J(){return t?null:(r(!0),null!==a?N(!0):["/login","/recover","/register"].includes(null!=e?e:"")||A.replace("/login"),r(!1),a)}return(0,p.a)({queryKey:["lookToRefreshToken"],queryFn:()=>(function(){if(R.current&&clearTimeout(R.current),null===a)return null;let e=(a?JSON.parse(atob(a.split(".")[1])).exp:0)*1e3-Date.now()-6e4;return e<=0?M():R.current=setTimeout(()=>{M(),R.current=null},e),a})(),retry:0,enabled:j,refetchOnMount:!1}),(0,p.a)({queryKey:["getTokenFromStorage"],queryFn:()=>J(),retry:0,enabled:!j,refetchOnMount:!1}),{getTokenFromRequest:V,isLoading:t,token:a,isTokenQueried:j,logout:W,userId:w,isTokenExpired:U,login:z}}},45099:function(e,t,r){"use strict";r.d(t,{f:function(){return i}});var n=r(39099),o=r(89291);let i=(0,n.Ue)()((0,o.mW)((0,o.tJ)(e=>({codeVerifier:void 0,setCodeVerifier:t=>{e({codeVerifier:t,isLoading:!0})},resetCodeVerifier:()=>{e({codeVerifier:void 0,isLoading:!1})},isLoading:!1}),{name:"raid-code-verifier-storage"})))},40832:function(e,t,r){"use strict";r.d(t,{u:function(){return i}});var n=r(39099),o=r(89291);let i=(0,n.Ue)()((0,o.mW)((0,o.tJ)(e=>({InviteToken:void 0,setInviteToken:t=>{e({inviteToken:t})},resetInviteToken:()=>{e({inviteToken:void 0})}}),{name:"raid-invite-token-storage"})))},84475:function(e,t,r){"use strict";r.d(t,{p:function(){return i}});var n=r(39099),o=r(89291);let i=(0,n.Ue)()((0,o.mW)((0,o.tJ)(e=>({participant:void 0,setParticipant:t=>{e({participant:t})},resetParticipant:()=>{e({participant:void 0})}}),{name:"raid-participant-storage"})))},64773:function(e,t,r){"use strict";r.d(t,{L:function(){return i}});var n=r(39099),o=r(89291);let i=(0,n.Ue)()((0,o.mW)((0,o.tJ)(e=>({user:void 0,setUser:t=>{e({user:t})},resetUser:()=>{e({user:void 0})}}),{name:"raid-user-storage"})))}},function(e){e.O(0,[310,756,629,971,23,744],function(){return e(e.s=92148)}),_N_E=e.O()}]);